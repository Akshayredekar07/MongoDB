
# Map-Reduce in MongoDB

Map-Reduce is a data processing paradigm for condensing large volumes of data into useful aggregated results.

It is a very popular topic in most of the languages/technologies like Java, Python, Hadoop, etc.

An aggregation pipeline provides better performance and usability than the Map-Reduce operation. Hence, it is not a replacement for the aggregation pipeline; it is just an alternative with limited functionality.

## Dataset Example
```text
_id, name, round, points, city  
1, TeamA, 1, 5, Hyderabad  
2, TeamB, 1, 3, Bangalore  
3, TeamC, 1, 4, Chennai  
4, TeamD, 1, 5, Hyderabad  
5, TeamA, 2, 5, Hyderabad  
6, TeamB, 2, 10, Bangalore  
7, TeamC, 2, 3, Chennai  
8, TeamD, 2, 7, Hyderabad  
9, TeamA, 3, 10, Hyderabad  
10, TeamB, 3, 4, Bangalore  
11, TeamC, 3, 1, Chennai  
12, TeamD, 3, 5, Hyderabad  
13, TeamA, 4, 8, Hyderabad  
14, TeamB, 4, 7, Bangalore  
15, TeamC, 4, 7, Chennai  
16, TeamD, 4, 9, Hyderabad  
```

**TeamA** → [5, 1, 10, 8] → **Map**  
**Total Points** → 28 → **Reduce**

## Find Team-wise Total Number of Points

### Using Aggregation Framework
```javascript
db.quiz.aggregate([
    { $group: { _id: "$name", totalPoints: { $sum: "$points" } } },
    { $out: "aggregation_pipeline_collection" }
]);

// Output
[
  { _id: 'TeamD', totalPoints: 26 },
  { _id: 'TeamC', totalPoints: 15 },
  { _id: 'TeamB', totalPoints: 24 },
  { _id: 'TeamA', totalPoints: 28 }
]
```

### Using Map-Reduce
We can implement the Map-Reduce paradigm using two functions:
1. **Map Function**  
   This function maps fields in input documents, i.e., it maps key fields to value fields.

   ```javascript
   var mapFunction = function() {
       emit(this.name, this.points);
   };
   ```
   Example:  
   **TeamA** → [5, 1, 10, 8]

2. **Reduce Function**  
   This function processes key-value pairs generated by the map function and produces aggregated results.

   ```javascript
   var reduceFunction = function(key, values) {
       return Array.sum(values);
   };
   ```

### Perform Map-Reduce on All Documents
Use the `mapReduce()` method. It works similarly to the `aggregate()` method.

```javascript
db.quiz.mapReduce(
    mapFunction, 
    reduceFunction, 
    { out: "map_reduce_collection" }
);
```

To display aggregated results inline:
```javascript
db.quiz.mapReduce(
    mapFunction,
    reduceFunction,
    { out: { inline: 1 } }
);
```

### Example Map-Reduce Execution
```javascript
var mapFunction = function() {
    emit(this.name, this.points); 
};

var reduceFunction = function(key, values) {
    return Array.sum(values);
};

db.quiz.mapReduce(
    mapFunction,
    reduceFunction,
    { out: { inline: 1 } }
);
```

### Options for Map-Reduce
The options `query`, `sort`, and `limit` can be applied before the `mapFunction` execution.

```javascript
db.quiz.mapReduce(
    mapFunction,
    reduceFunction,
    { 
        query: { name: "TeamA" },
        sort: { points: -1 },
        limit: 2,
        out: { inline: 1 }
    }
);
```

### Execution Order
`query` → `sort` → `limit` → `map` → `reduce` → `result`
